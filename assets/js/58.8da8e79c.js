(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{328:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"使用-github-actions-建立打包发布流水线"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-github-actions-建立打包发布流水线"}},[t._v("#")]),t._v(" 使用 github-actions 建立打包发布流水线")]),t._v(" "),s("h3",{attrs:{id:"发布-vuepress-1-x-x-到-github-pages"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布-vuepress-1-x-x-到-github-pages"}},[t._v("#")]),t._v(" 发布 vuepress(1.x.x) 到 github pages")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("建立项目")])]),t._v(" "),s("li",[s("p",[t._v("在根目录创建 .github/workflows 目录，在其中添加.yml 文件")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build and Deploy\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("push"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听push操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-and-deploy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@master\n\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" vuepress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jenkey2011/vuepress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deploy@master "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这是一个打包发布工具")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ACCESS_TOKEN")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.ACCESS_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在github项目中配置的环境变量，值为 Personal access token 中生成的token")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TARGET_REPO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hiraras/blog "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打包后的目标仓库")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TARGET_BRANCH")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打包后的目标分支，gh-pages会自动发布到github pages")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BUILD_SCRIPT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yarn "),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(" yarn docs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建命令")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("BUILD_DIR")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docs/.vuepress/dist "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建产物的路径")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("创建 Personal access token")]),t._v(" "),s("ul",[s("li",[t._v("点击头像")]),t._v(" "),s("li",[t._v("Settings")]),t._v(" "),s("li",[t._v("Developer settings")]),t._v(" "),s("li",[t._v("Personal access tokens")]),t._v(" "),s("li",[t._v("Tokens(classic)")]),t._v(" "),s("li",[t._v("勾选相关权限后生成")])])])]),t._v(" "),s("p",[t._v("生成的 token 需要保存，不然再进来的时候是无法查看的，只能重新生成")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[t._v("创建仓库变量（有两种变量，Environment secrets 和 Repository secrets，前者范围小一点可能在 yml 文件中读不到，后者是仓库变量，具体还需要深入研究）")]),t._v(" "),s("ul",[s("li",[t._v("进到对应项目")]),t._v(" "),s("li",[t._v("Settings")]),t._v(" "),s("li",[t._v("Secrets and variables")]),t._v(" "),s("li",[t._v("Actions")]),t._v(" "),s("li",[t._v("New repository secret")]),t._v(" "),s("li",[t._v("创建 ACCESS_TOKEN ,值为上面的 token")])])]),t._v(" "),s("li",[s("p",[t._v("在远程创建 gh-pages 分支")])]),t._v(" "),s("li",[s("p",[t._v("在 github pages 中配置发布分支")]),t._v(" "),s("ul",[s("li",[t._v("进到对应项目")]),t._v(" "),s("li",[t._v("Settings")]),t._v(" "),s("li",[t._v("Pages")])])]),t._v(" "),s("li",[s("p",[t._v("后续提交就会自动执行流水线啦")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{282:function(t,e,i){"use strict";i.r(e);var a=i(14),v=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"immer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#immer"}},[t._v("#")]),t._v(" immer")]),t._v(" "),e("h3",{attrs:{id:"概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[t._v("#")]),t._v(" 概念")]),t._v(" "),e("p",[t._v("immutable 指的是：当修改在原对象的基础上衍生出的对象时，不会对原对象的属性产生影响")]),t._v(" "),e("p",[t._v("这个概念正好可以使用在 redux 中，redux 的 reduce 每次需要返回一个新的对象，并且不能直接修改上一次的对象，因为可能造成状态混乱；而如果 state 的层级太深，则需要使用多个扩展运算符或 Object.assign 方法，代码很不直观。有两种解决方案：")]),t._v(" "),e("ul",[e("li",[t._v("1.深拷贝上一次的 state，但是这种每次都深拷贝的话比较耗费性能")]),t._v(" "),e("li",[t._v("2.使用 immer、immutable 或其他类库，这些类库既可以保证数据的不变性，又可以提高代码的可读性，详情见相应的笔记")])]),t._v(" "),e("h3",{attrs:{id:"immer-库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#immer-库"}},[t._v("#")]),t._v(" immer 库")]),t._v(" "),e("p",[t._v("内部使用了 es6 的 proxy 代理目标对象，如果不支持 proxy 的环境会降级为 Object.defineProperty，但此时效率会降低")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("优点：")]),t._v(" "),e("ol",[e("li",[t._v("使用方式很简单，代码很简洁，像是直接在对象上修改一样的操作")]),t._v(" "),e("li",[t._v("迁移、改造比较简单")]),t._v(" "),e("li",[t._v("效率高")])])]),t._v(" "),e("li",[e("p",[t._v("缺点：")]),t._v(" "),e("p",[t._v("依赖环境，如：proxy 和 defineProperty，如果不支持的环境则不可使用")])])]),t._v(" "),e("h3",{attrs:{id:"immutable"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#immutable"}},[t._v("#")]),t._v(" immutable")]),t._v(" "),e("p",[t._v("使用例子")]),t._v(" "),e("img",{attrs:{src:t.$withBase("/img/code-manage-immer.png")}}),t._v(" "),e("ul",[e("li",[t._v("优点：\n"),e("ol",[e("li",[t._v("保证了数据的不变性，同时如果深层对象没有被转化过，那么它的引用性还是会保持的（使用===返回 true）")]),t._v(" "),e("li",[t._v("一定程度上代码更直观了")]),t._v(" "),e("li",[t._v("不依赖环境")])])]),t._v(" "),e("li",[t._v("缺点：\n"),e("ol",[e("li",[t._v("生成新对象需要使用 api，代码上看去全是他的 api，还有好多配合的数组对象")]),t._v(" "),e("li",[t._v("api 不够直观，a.set 看着像为 a 对象设置属性，但是却是返回一个 immutable 对象")]),t._v(" "),e("li",[t._v("可能需要将不可变对象转化为一般对象，例如在把对象传递给组件的时候、网络传输的时候，此时效率有损耗")]),t._v(" "),e("li",[t._v("代码改造、迁移的时候成本比较高")])])])])])}),[],!1,null,null,null);e.default=v.exports}}]);